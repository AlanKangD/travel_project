<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.care.root.mybatis.qna.QnAMapper">

	<resultMap  id="qna" type="com.care.root.qna.dto.QnADTO">
	   <id property="qnaNo" column="qna_no"/>
	   <result property="qnaTitle" column="qna_title"/>
	   <result property="qnaContent" column="qna_content"/>
	   <result property="qnaHit" column="qna_hit"/>
	   <result property="saveDate" column="savedate"/>
	   <result property="qnaPwd" column="qna_pwd"/>
	   <result property="id" column="id"/>
    </resultMap>
    <resultMap  id="qnaReply" type="com.care.root.qna.dto.QnARepDTO">
	   <result property="id" column="id"/>
	   <result property="qrContent" column="qr_content"/>
	   <result property="qrWriteGroup" column="qr_write_group"/>
	   <result property="saveDate" column="savedate"/>
	   <result property="qrId" column="qr_id"/>
    </resultMap>
    
    <select id="qnaAllList" resultMap="qna">
    	select B.* from(select rownum rn, A.* from
    	(select * from qna_board order by qna_no desc)A)B where rn between #{s} and #{e}
    </select>

    <select id="repAllList" resultMap="qnaReply">
    	select distinct qr_write_group from qna_reply
    </select>
    
    <insert id="writeSave">
    	insert into qna_board(qna_no,qna_title,qna_content,qna_pwd,id)
    	values(qna_board_SEQ.nextval,#{qnaTitle},#{qnaContent},#{qnaPwd},#{id})
    </insert>
    
    <select id="contentView" resultMap="qna">
    	select * from qna_board where qna_no = #{qnaNo}
    </select>
    
    <update id="upHit">
    	update qna_board set qna_hit = qna_hit + 1 where qna_no = #{qnaNo}
    </update>
    
    <delete id="delete">
    	delete from qna_board where qna_no = #{qnaNo}
    </delete>
    
     <update id="modify">
    	update qna_board set qna_title = #{qnaTitle}, qna_content = #{qnaContent}
    	where qna_no = #{qnaNo}
    </update>
    
    <select id="getDataCount" resultType="Integer">
    	select count(*) from qna_board
    </select>
    
    <insert id="addReply">
    	insert into qna_reply(id,qr_content,qr_write_group,qr_id)
    	values(#{id},#{qrContent},#{qrWriteGroup},qna_reply_SEQ.nextval)
    </insert>
    
    <select id="getReply" resultMap="qnaReply">
     	select * from qna_reply where qr_write_group = #{qrWriteGroup}
     	order by savedate asc
    </select>
    
     <delete id="repDelete">
    	delete from qna_reply where qr_id = #{qrId}
    </delete>
    
     <update id="repModify">
    	update qna_reply set qr_content = #{qrContent} where qr_id = #{qrId}
    </update>

</mapper> 